## Инструкция подключения и настроек интеграции Bitrix24 - "Мегафон" <br />
**Термины:**
- Портал amocrm - это обобщенная информация об аккаунте amocrm с конкретным доменом. Например «Проверяйте настройки и тарифы на своем портале amocrm». Некоторые люди называют его ЛК amocrm или же сайт amocrm.
- Личный Кабинет (ЛК) – это личный кабинет (см. рисунок), который используется для настроек коммуникации звонков. <br />
![Без заголовка](https://github.com/user-attachments/assets/22bc4ae7-676d-4cef-8272-38acbea6930b)

**Как подключить интеграцию.** <br />
1. После выполнения входа в личный кабинет https://admin-app.cp.megafon.ru/ необходимо перейти в раздел «Интеграции»: <br />
![1](https://github.com/user-attachments/assets/d1555cc2-6667-4645-8e16-ce41ca2deb68) <br />
2. Выберете интеграцию «Bitrix24» в разделе «CRM».
![379149380-d1555cc2-6667-4645-8e16-ce41ca2deb68](https://github.com/user-attachments/assets/b4518b28-aeb0-478b-a7f5-6bcac9ca795b) <br />
3. Так будет выглядеть место подключения интеграции: <br />
![379150299-fbfc8ccc-92fd-4312-8f1a-5061306f5b7d](https://github.com/user-attachments/assets/3a6e6f62-6df4-4d45-aa27-918778fb983d) <br />
4. Чтобы ее активировать, необходимо нажать кнопку «Подключить интеграцию». В результате, откроется окно:
![Снимок экрана 2024-12-09 в 09 38 37](https://github.com/user-attachments/assets/9a9d22f4-9c10-4807-9f3f-c09915a5f70c) <br />

Если в выпадающем списке в поле «Аккаунт» нет нужного нам подключаемого портала, то необходимо нажать кнопку «Добавить учетные данные», вам откроется такое окно: <br />
![Снимок экрана 2024-12-09 в 09 45 06](https://github.com/user-attachments/assets/ed95d735-7df8-4c52-9d46-8f2f2e94571e) <br />

Поле «Название» не обязательное для заполнения. Необходимо для отображения в списке аккаунтов и их быстрой идентификации, если вы используете несколько порталов интеграции. В обязательном поле «Домен портала» указывается url подключаемого ресурса, желательно с протоколом, например: (https://comagic.bitrix24.ru/) <br />
![Снимок экрана 2024-12-09 в 09 43 08](https://github.com/user-attachments/assets/71d8115c-390d-4315-984e-9142fae3728e) <br />

Также, есть возможность отредактировать уже созданные вами учетные данные. <br />
Для этого, в выпадающем списке, необходимо нажать «шестеренку» напротив портала, который вы хотите отредактировать. <br />
<img width="470" alt="11" src="https://github.com/user-attachments/assets/8f00e67c-e4ac-4e0f-a629-c0f1f3844b70"> <br />

При нажатии откроется окно из скриншота выше. Можно будет отредактировать название, либо удалить его, поменять адрес портала, сохранить или отменить измененные данные, либо целиком удалить учетные данные. <br />

После выбора нужного вам портала, сохраните результат и вам откроется окно настроек интеграции: <br />
![Снимок экрана 2024-12-09 в 09 47 09](https://github.com/user-attachments/assets/71455578-c8da-422c-a58d-87d0cbfc317e) <br />

**Важно!** в самом начале страницы настроек включить тоггл «Интеграция активна» и нажать кнопку сохранить внизу. По умолчанию, данный тоггл выключен. Всё это необходимо для корректной работы установленных в дальнейшем настроек звонков. <br />
![Снимок экрана 2024-12-09 в 09 48 17](https://github.com/user-attachments/assets/ea51d699-9e6a-450a-9a36-0789f1d0e62c) <br />


## Какие есть "Настройки интеграции" и как они работают. <br />

**Страница настроек делится на блоки:** <br />
•	Учетные данные <br />
•	Параметры интеграции <br />
•	Входящие <br />
•	Исходящие <br />
•	Прочее <br />
•	Сопоставления сотрудников* <br />

Напротив переключателей есть подсказки, которые появляются при наведении на иконку восклицательного знака. <br />
![Снимок экрана 2024-12-09 в 10 30 21](https://github.com/user-attachments/assets/1b22800e-e85e-46e7-9308-4e2f0440800e) <br />

**Начнем с блока "Учетные данные".** Здесь показано название портала, с которым у нас настроена интеграция, а также возможность его смены в выпадающем списке. <br />
![Снимок экрана 2024-12-09 в 10 32 47](https://github.com/user-attachments/assets/52c81592-8f79-4356-808e-c1f56c87c90b) <br />

Далее идут "Параметры интеграции" с переключателем "Интеграция активна" и полем с выбором режима работы телефонии. <br />
Перключатель "Интеграция активна" отвечает в целом за работу функциональности вашей интеграции, поэтому при отключении данного переключателя - интеграция не будет работать. <br />
**Поле с выбором режима телефонии:** <br />
• Использовать WebRTC виджет <br />
• Использовать IP телефонию <br />
![Снимок экрана 2024-12-09 в 10 55 44](https://github.com/user-attachments/assets/0164d9f3-169e-4791-9f03-8ecf403b41e4)

Настройки «Входящих» звонков. Их функциональность не отличается от раздела «Исходящие звонки», кроме наличия "Переадресации на персонального менеджера" и "Назначать ответственного на". Данные функциональности доступна только для «Входящих звонков».
Напротив большинства тогглов расположены подсказки. <br />
![Снимок экрана 2024-12-09 в 10 34 31](https://github.com/user-attachments/assets/100ca249-413c-438e-a8ed-258a9dc5cde6) <br />

**Разберем все возможности по порядку:** <br />

**Раздел "Входящие" имеет настройки:** <br />
• "Переадресация на персонального менеджера" - данный функционал перенаправляет звонок в зависимости от того, какой персональный менеджер назначен у контакта в CRM. Производится поиск персонального менеджера при сценарном звонке. Данный функционал доступен только для входящих звонков. <br />
• "Создавать сущность при входящем звонке" - при включении даннного функционала, при входящем звонке будут созданы сущности, в зависимости от настроек режима работы с CRM в Bitrix24 <br />
• "Ответственный по-умолчанию на входящий звонок" - Поле обязательное к заполнению. Сотрудник, который будет назначен ответственным за сущность/звонок в случае пропущенного входящего звонка <br />
• "Назначать ответственного на" - Поле обязательное к заполнению. В случае успешного звонка можно выбрать кого назначить ответственным за звонок: первого или последнего разговаривавшего с клиентом сотрудника. Настройка применяется для новых лидов при наличии трансфера во время разговора. <br />
![Снимок экрана 2024-12-09 в 11 34 24](https://github.com/user-attachments/assets/29654f1d-70e8-4779-86c1-8e5c81756103)

Назначать ответственного можно на: <br />
• Первого разговаривающего - назначаться будет звонок за первым разговаривающим по входящему звонку <br />
или <br />
• На последнего разговаривающего - назначаться будет звонок за последним разговаривающим по входящему звонку <br />
![Снимок экрана 2024-12-09 в 11 37 36](https://github.com/user-attachments/assets/14bf9cd3-1a30-449c-8e23-ed6a0de84d27) <br />

**Раздел "Исходящие" имеет настройки:** <br />
• "Создавать сущность при исходящем звонке" - при включении даннного функционала, при входящем звонке будут созданы сущности, в зависимости от настроек режима работы с CRM в Bitrix24 <br />
• "Ответственный по-умолчанию на исходящий звонок" - Поле обязательное к заполнению. Ответственный по-умолчанию на исходящий звонок, в случае, если ответственный не найден в системе. <br />
![Снимок экрана 2024-12-09 в 11 31 17](https://github.com/user-attachments/assets/3957bacb-4293-455a-a78c-e802b040951c) <br />

**Раздел "Прочее" имеет настройки:** <br />
![Снимок экрана 2024-12-09 в 11 39 05](https://github.com/user-attachments/assets/19469098-5a89-4a35-86fd-1998b951ae3a) <br />
• "Использовать CallTracking" - при включении открывает возможность выбрать какие передавать UTM метки в Bitrix24. <br />
![Снимок экрана 2024-12-09 в 11 40 53](https://github.com/user-attachments/assets/a6452f0d-6fc3-4a54-b002-03a73ab056f7) <br />
• "Добавлять сообщение о совершенном звонке сотруднику в чат" - при включении, в чат сотруднику будет поступать сообщение о входящем звокнке. <br />

**Раздел "Сопоставления сотрудников":** <br />
Данный функционал нужен, чтобы установить связь между вашим сотрудником в Bitrix24 и Сотрудником АТС для соверщения звонков посредством интеграции. <br />
Также доступен переключатель "Использовать пользователя для поиска персонального менеджера" - который решает, будет ли данный пользователь учавствовать в переадресации. <br />
![Снимок экрана 2024-12-09 в 11 42 51](https://github.com/user-attachments/assets/c2e021de-d9fc-412f-ad23-55cf77032334) <br />
