## Инструкция подключения и настроек интеграции amocrm - "Мегафон" <br />
**Термины:**
- Портал amocrm - это обобщенная информация об аккаунте amocrm с конкретным доменом. Например «Проверяйте настройки и тарифы на своем портале amocrm». Некоторые люди называют его ЛК amocrm или же сайт amocrm.
- Личный Кабинет (ЛК) – это личный кабинет (см. рисунок), который используется для настроек коммуникации звонков. <br />
![Без заголовка](https://github.com/user-attachments/assets/22bc4ae7-676d-4cef-8272-38acbea6930b)

**Как подключить интеграцию.** <br />
1. После выполнения входа в личный кабинет https://admin-app.cp.megafon.ru/ необходимо перейти в раздел «Интеграции»: <br />
![1](https://github.com/user-attachments/assets/d1555cc2-6667-4645-8e16-ce41ca2deb68) <br />
2. Выберете интеграцию «amoCRM» в разделе «CRM».
![2](https://github.com/user-attachments/assets/ccd6f1d1-e31e-44d4-84f3-483d2aa2db19) <br />
3. Так будет выглядеть место подключения интеграции: <br />
![4](https://github.com/user-attachments/assets/fbfc8ccc-92fd-4312-8f1a-5061306f5b7d) <br />
4. Чтобы ее активировать, необходимо нажать кнопку «Подключить интеграцию». В результате, откроется окно:
   <img width="411" alt="6" src="https://github.com/user-attachments/assets/f1c96900-270a-4fa7-9c1e-3bed61225755"> <br />

Если в выпадающем списке «Выберите аккаунт» в поле «Выберите элемент» нет нужного нам подключаемого портала, то необходимо нажать кнопку «Добавить учетные данные»: <br />
![7](https://github.com/user-attachments/assets/ae1691b6-c2b6-4ade-a519-8a6f3e747bde) <br />

Поле «Название» не обязательное для заполнения. Необходимо для отображения в списке аккаунтов и их быстрой идентификации, если вы используете несколько порталов интеграции. В обязательном поле «AmoCRM URL» указывается url подключаемого ресурса, желательно с протоколом, например: https://amo2comagicdev.amocrm.ru <br />
<img width="395" alt="8" src="https://github.com/user-attachments/assets/f374439d-9938-4f92-a208-758e857e195a"> <br />

Также, есть возможность отредактировать уже созданные вами учетные данные. <br />
Для этого, в выпадающем списке, необходимо нажать «шестеренку» напротив портала, который вы хотите отредактировать. <br />
<img width="470" alt="11" src="https://github.com/user-attachments/assets/8f00e67c-e4ac-4e0f-a629-c0f1f3844b70"> <br />

При нажатии откроется окно из скриншота выше. Можно будет отредактировать название, либо удалить его, поменять адрес портала, сохранить или отменить измененные данные, либо целиком удалить учетные данные. <br />
После выбора нужного вам портала, сохраните результат и вам откроется окно настроек интеграции: <br />
<img width="470" alt="9" src="https://github.com/user-attachments/assets/c2e745d9-e2c2-4a0a-a236-14e187070fcf"> <br />

**Важно!** в самом низу страницы настроек включить тоггл «Интеграция активна» и нажать кнопку сохранить. По умолчанию, данный тоггл выключен. Всё это необходимо для корректной работы установленных в дальнейшем настроек звонков. <br />
<img width="470" alt="10" src="https://github.com/user-attachments/assets/73bfb1cb-a70b-4cfb-85a0-a8dab437f847"> <br />

## Какие есть "Настройки интеграции" и как они работают. <br />

**Страница настроек делится на блоки:** <br />
•	Учетные данные <br />
•	Входящие звонки <br />
•	Исходящие звонки <br />
•	Сопоставление пользователей CRM и ваших сотрудников <br />
•	Прочие параметры интеграции <br />

Напротив переключателей есть подсказки, которые появляются при наведении на восклицательный знак в круге. <br />
<img width="393" alt="12" src="https://github.com/user-attachments/assets/2c4edd64-36c6-4d80-a5fc-20882f58ca80"> <br />

**Начнем с блока "Учетные данные".** Здесь показано название портала, с которым у нас настроена интеграция, а также возможность его смены в выпадающем списке. <br />
<img width="470" alt="13" src="https://github.com/user-attachments/assets/b87a3406-5927-49d5-a027-ae6f49569f46"> <br />

Далее идут настройки «Входящих звонков». Их функциональность не отличается от раздела «Исходящие звонки», кроме наличия «Переадресации на персонального менеджера». Данная функциональность доступна только для «Входящих звонков».
Напротив большинства тогглов расположены подсказки. <br />
<img width="470" alt="14" src="https://github.com/user-attachments/assets/cdef0470-003f-40ff-b67c-52c4c80af5a3"> <br />

**Разберем все возможности по порядку:**

1. **"Успешный звонок с неизвестного номера".** При включении тоггла, все успешные входящие звонки с неизвестного номера, будет создавать заданные настройками сущности. В поле «Действие» нужно выбрать один из вариантов - какую сущность или сущности надо создать при таком звонке.
- Только действие «Создавать новый контакт и сделку» предполагает обязательный выбор как воронки, так и этапа, в котором будут созданы сущности.
- При выборе действия «Создавать запись в неразобранном» - обязательным выбором будет только воронка, без указания этапа. Важно учитывать, что действие «Создавать запись в неразобранном» всегда будет создавать запись в неразобранном вне зависимости от наличия активных сделок и других условий.
- При выборе действия «Создавать новый контакт» указания воронки и этапа не требуется. Дополнительные настройки в этом варианте не подразумеваются. <br />
<img width="362" alt="15" src="https://github.com/user-attachments/assets/b39cee1f-5205-4eb0-9c58-c71d18213626"> <br />
<img width="361" alt="16" src="https://github.com/user-attachments/assets/44f21a73-3fa6-4fd7-9697-59ab6a40119c"> <br />
<img width="360" alt="17" src="https://github.com/user-attachments/assets/417e16eb-39b1-434a-a378-f32f134be7e1"> <br />

2.	**"Непринятый звонок с неизвестного номера".** При включении этого переключателя будут создаваться сущности, если будет поступать звонок с неизвестного номера, который менеджер не принял. Создаваемые сущности и выполняемые действия можно выбрать такие же, как в пункте 1. <br />
<img width="470" alt="18" src="https://github.com/user-attachments/assets/15d25e2e-7e86-46c8-b8fe-06b92d65c089"> <br />

3.	**"Успешный звонок от существующего клиента".** При включении этого переключателя будут создаваться сущности, если будет поступать звонок от уже существующего клиента в сrm и этот звонок успешен. Т.е. менеджер принял этот звонок и не было технических сбоев. Имеет все те же действия что в 1 пункте, кроме создания сущности контакта. Вместо него есть другое действие «Создавать сделку всегда». Выбор воронки и этапа также доступен при выборе всех действий, кроме «Создавать запись в неразобранном».
**Важно!** При выборе «Создавать сделку всегда», сделка будет создаваться только по завершению звонка. <br />
   <img width="470" alt="20" src="https://github.com/user-attachments/assets/5ffaa6ad-270c-49c9-a7bc-0a51279e8259"> <br />

4. "Непринятый звонок от существующего клиента". При включении этой настройки будут создаваться сущности, если будет поступать звонок от существующего в crm клиента и данный звонок не будет принят менеджером. Все внутренние действия, воронки, этапы аналогичны пункту выше. <br />
   <img width="358" alt="1" src="https://github.com/user-attachments/assets/aaf9deca-c05e-4849-b5b7-6b31f20e137a">

## Прочие настройки входящих звонков: <br />
- **"Добавлять теги к сделке и контакту".** При включении данной настройки, будет добавлять тег «номер телефона клиента» при входящем или исходящем для всех создаваемых звонком сущностей в сделку и в контакт. <br />
**Особенность этой настройки** - тег вешается как на сделку, так и на контакт <br />
  <img width="366" alt="2" src="https://github.com/user-attachments/assets/1517596e-3f91-4ff0-98ff-8c3a967d610b"><br />

- **"Создавать задачу сотруднику, принявшему звонок".** При включении данной настройки создается задача на сотрудника, который принял звонок. <br />
   <img width="367" alt="3" src="https://github.com/user-attachments/assets/6547b2fe-5548-4214-be8d-d1bf405c190b"> <br />
   ![4](https://github.com/user-attachments/assets/5183214d-5807-46af-a306-77f68bad6dee) <br />

- **"Переадресация на персонального менеджера".** При включении данной настройки, все звонки будут переадресованы на менеджера, который указан ответственным в контакте амо. При выключенной – переадресация срабатывать не будет, звонок будет идти на ответственного по-умолчанию или указанного в сценариях входящих звонков. <br />
**Важно!** Для корректной работы данной функциональности, необходимо также установить в разделе «Сопоставление пользователей CRM и ваших сотрудников», иначе звонки с переадресацией будут идти на ответственного по-умолчанию, так как система не найдет нужного пользователях. <br />
   <img width="347" alt="5" src="https://github.com/user-attachments/assets/64a8bd40-6990-415f-9ec7-f71ca1cafc3d"> <br />

Также, если во «Входящих сценариях» по номеру, которому звонят клиенты, будет выбран сценарий переадресации на сотрудника, то все входящие звонки будут приходить на выбранного в этом сценарии сотрудника. В этом случае, приоритет отработки у сценариев. Если номер будет принадлежать только одному сотруднику – то все звонки также будут поступать на него. <br />
Чтобы заработала история с обработкой персонального менеджера, необходимо перейти в раздел «Настройки АТС» - «Входящие сценарии». <br />
<img width="470" alt="6" src="https://github.com/user-attachments/assets/42949137-7060-42f2-ad1e-14a4124cc571"> <br />

Откроется окно, в котором будет список номеров. Нужно нажать на три точки справа и выбрать в списке «Добавить сценарий» - «Создать новый». <br />
![7](https://github.com/user-attachments/assets/bf33c1d2-5757-49b9-b7cb-af78c67f3d6b) <br />

В открывшимся окне, во входящих сценариях для номера, выбрать вариант «Персональный менеджер». <br />
<img width="468" alt="8" src="https://github.com/user-attachments/assets/14b91664-d53d-4492-8668-437a4a7c55aa"> <br />

- **Поле "Ответственный менеджер по-умолчанию в amoCRM".** Обязательное поле для заполнения. При создании сущностей в amoCRM контакту будет присвоен выбранный в этом поле ответственный. <br />
<img width="345" alt="9" src="https://github.com/user-attachments/assets/0299cca8-fdc6-48a6-bdd7-4e0007819501"> <br />

- **"Фильтровать входящие звонки".** В данном поле можно добавить номера телефонов, которые будет фильтровать система. В случае, если с указанного номера будет поступать входящий звонок, то все включенные тогглы на создание сущностей для этого номера срабатывать не будут. Аналогично работает такая же настройка в «Исходящих звонках». Для исходящих вызовов на указанный в этом поле номер система не будет создавать сущности. <br />
   <img width="338" alt="10" src="https://github.com/user-attachments/assets/d5ae47a8-db9d-4a48-822b-3817eea249c9"> <br />

**Настройки для «Исходящих звонков» такие же как для входящих. Работают по вышеописанной логике. Единственное отличие - функциональности «Переадресация на персонального менеджера» в «Исходящих звонках» нет.**
